<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Cycling Apparel Size Analyzer">
    <meta property="og:description" content="Waist vs Hip Body Measurements + Brand Size Boxes">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: transparent;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 100%;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #393710;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .brand-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .brand-tab {
            padding: 10px 16px;
            border: 2px solid #ddd;
            background-color: white;
            color: #333;
            cursor: pointer;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .brand-tab:hover {
            border-color: #393710;
            color: #393710;
        }

        .brand-tab.active {
            background-color: #393710;
            color: white;
            border-color: #393710;
        }

        .all-brands-btn {
            padding: 10px 16px;
            background-color: #f0f0f0;
            border: 2px solid #999;
            color: #333;
            cursor: pointer;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .all-brands-btn:hover {
            border-color: #393710;
            color: #393710;
        }

        .all-brands-btn.active {
            background-color: #393710;
            color: white;
            border-color: #393710;
        }

        .chart-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        svg {
            width: 100%;
            height: auto;
            min-height: 600px;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 4px solid #393710;
            border-radius: 4px;
        }

        .stat-box h3 {
            color: #393710;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .stat-box p {
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        .legend {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
            font-size: 12px;
        }

        .legend-item {
            display: inline-block;
            margin-right: 25px;
            margin-bottom: 8px;
        }

        .legend-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 6px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cycling Apparel Size Analyzer</h1>
            <p>Waist vs Hip Body Measurements + Brand Size Boxes</p>
        </div>

        <div class="controls">
            <button class="all-brands-btn active" onclick="showAllBrands()">All Brands Overlay</button>
            <div class="brand-tabs" id="brandTabs"></div>
        </div>

        <div class="chart-container">
            <svg id="chart"></svg>
            <div class="legend" id="legend"></div>
        </div>

        <div class="stats" id="stats"></div>
    </div>

    <script>
        // Data with 500 real anthropometric data points from cycling dataset
        const data = {
            anthropometric_data: [[38.2, 41.9], [30.16, 39.1], [38.08, 45.37], [34.57, 41.9], [36.1, 43.01], [39.79, 44.9], [32.65, 38.25], [31.25, 37.48], [35.66, 41.79], [27.22, 34.07], [30.57, 36.42], [30.69, 37.4], [32.47, 40.72], [35.15, 41.13], [39.1, 43.99], [34.9, 38.67], [33.58, 41.75], [39.48, 44.98], [28.44, 36.71], [33.8, 38.13], [34.28, 40.47], [40.67, 43.47], [37.68, 41.63], [37.41, 41.97], [33.63, 38.45], [36.36, 41.57], [33.46, 41.18], [34.4, 42.52], [34.1, 41.01], [30.7, 37.88], [28.32, 36.61], [34.73, 40.81], [34.76, 40.87], [32.94, 40.52], [30.92, 38.02], [47.21, 48.03], [38.73, 41.78], [44.02, 47.09], [31.99, 41.57], [32.12, 37.73], [30.3, 37.6], [37.04, 43.75], [34.13, 38.54], [31.08, 40.57], [30.1, 37.65], [27.24, 34.48], [31.74, 38.94], [38.66, 43.4], [35.55, 42.2], [32.41, 39.74], [42.57, 46.4], [32.83, 40.4], [28.1, 35.4], [35.15, 40.04], [34.68, 40.57], [33.44, 44.82], [45.73, 50.22], [35.78, 42.5], [28.12, 35.83], [36.69, 43.12], [37.23, 41.07], [30.69, 38.21], [36.95, 39.88], [36.0, 40.76], [28.99, 34.64], [36.44, 41.95], [29.34, 36.99], [40.11, 46.07], [30.98, 39.95], [29.71, 41.56], [32.7, 39.69], [28.82, 35.42], [33.5, 41.69], [33.09, 41.11], [41.98, 45.65], [35.71, 41.66], [32.15, 37.95], [34.47, 40.89], [33.6, 39.37], [33.25, 39.08], [47.26, 53.58], [33.63, 39.22], [39.87, 44.92], [30.16, 39.1], [34.43, 40.95], [36.22, 40.64], [34.88, 42.96], [28.49, 37.76], [33.82, 41.49], [31.49, 40.39], [35.66, 43.04], [33.55, 41.94], [32.72, 41.73], [35.15, 38.09], [36.46, 43.09], [32.15, 41.17], [34.22, 41.97], [32.99, 37.57], [34.7, 38.82], [30.79, 38.52], [35.94, 41.04], [40.16, 44.97], [32.24, 41.15], [33.81, 40.35], [40.33, 43.96], [31.96, 38.75], [30.33, 36.79], [32.5, 37.09], [30.11, 36.91], [33.48, 41.98], [43.33, 46.23], [34.56, 39.73], [35.9, 40.98], [39.02, 44.89], [34.5, 38.97], [36.25, 44.43], [30.17, 37.19], [28.77, 34.53], [29.92, 36.52], [33.97, 39.16], [41.71, 50.71], [31.63, 36.62], [30.4, 38.06], [33.84, 40.77], [40.22, 44.64], [29.38, 37.98], [27.02, 34.98], [32.87, 39.0], [29.05, 36.8], [36.87, 43.54], [38.25, 44.25], [32.68, 39.21], [39.71, 44.21], [38.75, 43.87], [29.58, 36.94], [32.69, 39.48], [31.41, 38.94], [30.12, 40.42], [33.07, 42.86], [27.54, 35.89], [32.27, 36.23], [31.66, 38.65], [31.17, 38.73], [35.17, 40.36], [49.56, 50.53], [39.45, 44.07], [31.91, 38.57], [39.33, 42.24], [39.98, 44.45], [33.59, 37.84], [31.26, 36.66], [38.55, 41.58], [29.14, 36.22], [32.98, 39.34], [34.9, 40.55], [38.36, 41.6], [31.33, 37.36], [29.06, 35.43], [36.55, 44.3], [34.12, 40.37], [27.74, 35.16], [41.21, 44.15], [38.19, 43.63], [38.27, 44.57], [58.56, 61.73], [29.24, 35.03], [49.08, 54.02], [35.56, 40.53], [34.95, 41.61], [33.62, 39.17], [33.75, 37.8], [31.29, 39.24], [31.3, 38.84], [39.96, 41.14], [33.19, 39.07], [41.78, 43.9], [35.72, 43.86], [31.09, 40.63], [33.66, 40.39], [35.97, 41.7], [38.49, 43.71], [36.04, 42.06], [35.36, 41.31], [38.46, 44.33], [32.27, 38.06], [31.88, 39.3], [32.61, 40.78], [36.13, 42.56], [38.27, 42.78], [31.98, 37.04], [34.07, 40.42], [34.31, 40.96], [41.73, 45.47], [29.35, 35.87], [34.67, 40.59], [28.46, 36.33], [32.06, 40.54], [33.21, 39.02], [34.21, 40.32], [32.14, 37.81], [40.84, 44.37], [36.93, 42.17], [39.5, 42.97], [38.66, 42.37], [31.39, 37.66], [35.22, 40.04], [29.62, 35.33], [33.84, 38.24], [35.56, 41.72], [26.94, 35.92], [36.59, 40.69], [51.37, 52.3], [33.68, 38.0], [33.53, 38.91], [27.07, 34.27], [33.54, 39.85], [30.79, 39.44], [30.2, 35.84], [36.34, 40.25], [35.08, 42.94], [31.37, 39.84], [39.45, 45.0], [30.67, 36.1], [33.39, 39.69], [32.13, 37.11], [32.62, 41.24], [33.81, 39.44], [37.6, 43.69], [38.33, 44.21], [25.79, 34.63], [35.1, 40.34], [33.56, 41.06], [36.78, 41.0], [31.9, 38.43], [31.52, 38.06], [41.81, 45.38], [32.96, 39.19], [28.07, 36.64], [38.15, 41.39], [37.78, 42.44], [34.85, 40.62], [31.27, 36.23], [31.21, 37.9], [38.27, 44.47], [32.27, 40.54], [32.28, 39.32], [31.97, 38.99], [31.09, 37.44], [28.64, 36.09], [31.51, 38.16], [36.52, 43.21], [39.77, 46.86], [41.49, 44.38], [37.95, 39.74], [31.92, 41.88], [32.3, 39.76], [31.87, 38.97], [48.14, 48.9], [39.01, 44.63], [34.98, 41.37], [38.25, 43.79], [33.0, 40.63], [32.55, 38.91], [31.94, 36.8], [30.17, 36.52], [33.16, 41.39], [28.39, 35.02], [40.53, 44.71], [31.31, 37.87], [37.43, 42.19], [31.13, 37.93], [37.7, 43.66], [32.2, 39.3], [30.9, 38.05], [45.71, 48.47], [47.39, 48.96], [39.81, 44.66], [37.15, 43.72], [31.72, 37.99], [37.08, 42.76], [38.64, 43.93], [41.59, 46.35], [35.32, 43.83], [32.64, 39.07], [31.02, 39.19], [36.15, 45.22], [40.48, 44.52], [29.58, 37.56], [39.61, 45.09], [31.85, 37.99], [31.13, 39.86], [38.58, 43.98], [30.91, 37.53], [31.13, 40.39], [28.91, 37.12], [35.08, 43.07], [37.31, 40.49], [38.93, 44.29], [42.06, 47.9], [30.77, 36.78], [33.64, 40.18], [34.12, 39.86], [34.58, 40.46], [29.83, 36.55], [38.6, 44.49], [30.29, 36.47], [34.27, 38.36], [33.72, 39.06], [35.58, 42.66], [36.22, 41.09], [30.16, 38.59], [37.79, 42.38], [32.42, 40.15], [29.19, 38.08], [30.27, 36.04], [28.7, 35.48], [39.44, 44.41], [34.32, 41.43], [48.38, 49.42], [28.56, 36.2], [32.31, 39.97], [37.45, 47.87], [44.64, 49.28], [33.83, 39.51], [26.87, 35.48], [31.68, 39.58], [32.58, 39.67], [30.51, 38.09], [29.59, 38.08], [29.77, 37.04], [35.47, 39.81], [30.12, 38.06], [28.12, 34.62], [33.71, 40.79], [33.86, 42.82], [37.95, 45.15], [32.66, 39.83], [33.59, 42.73], [29.01, 34.83], [29.82, 39.65], [32.01, 40.33], [31.06, 38.49], [34.57, 41.97], [28.91, 36.75], [31.97, 40.48], [31.16, 36.43], [29.99, 36.66], [31.94, 40.55], [30.34, 36.49], [35.3, 41.93], [31.07, 39.86], [47.84, 51.68], [32.89, 39.23], [29.25, 37.61], [31.02, 40.19], [25.58, 32.72], [36.4, 44.36], [40.36, 44.49], [42.48, 45.54], [31.87, 40.04], [30.16, 36.82], [33.24, 38.99], [33.17, 38.39], [30.09, 38.23], [34.34, 39.29], [35.67, 41.17], [43.24, 46.85], [32.45, 37.91], [37.27, 44.59], [33.93, 41.49], [31.34, 38.71], [34.69, 41.19], [29.75, 36.22], [44.16, 48.76], [32.66, 36.95], [37.27, 42.82], [49.48, 49.2], [43.83, 47.44], [40.75, 44.78], [40.28, 44.55], [33.98, 42.24], [36.94, 42.81], [36.94, 42.81]],
            "brands": {"7mesh": {"sizes": {"XS": {"waist_min": 30.0, "waist_max": 30.0, "hip_min": 36.0, "hip_max": 36.0}, "S": {"waist_min": 32.0, "waist_max": 32.0, "hip_min": 38.0, "hip_max": 38.0}, "M": {"waist_min": 34.0, "waist_max": 34.0, "hip_min": 40.0, "hip_max": 40.0}, "L": {"waist_min": 36.0, "waist_max": 36.0, "hip_min": 42.0, "hip_max": 42.0}, "XL": {"waist_min": 39.0, "waist_max": 39.0, "hip_min": 44.0, "hip_max": 44.0}}}, "Club Ride": {"sizes": {"XS": {"waist_min": 27.0, "waist_max": 29.0, "hip_min": 33.0, "hip_max": 35.0}, "S": {"waist_min": 30.0, "waist_max": 31.0, "hip_min": 36.0, "hip_max": 38.0}, "M": {"waist_min": 32.0, "waist_max": 33.0, "hip_min": 39.0, "hip_max": 40.0}, "L": {"waist_min": 34.0, "waist_max": 36.0, "hip_min": 41.0, "hip_max": 43.0}, "XL": {"waist_min": 37.0, "waist_max": 39.0, "hip_min": 44.0, "hip_max": 46.0}, "XXL": {"waist_min": 40.0, "waist_max": 43.0, "hip_min": 47.0, "hip_max": 48.0}}}, "Fox Racing": {"sizes": {"26": {"waist_min": 28.0, "waist_max": 28.0, "hip_min": 32.0, "hip_max": 33.0}, "28": {"waist_min": 30.0, "waist_max": 30.0, "hip_min": 34.0, "hip_max": 35.0}, "30": {"waist_min": 32.0, "waist_max": 32.0, "hip_min": 36.0, "hip_max": 37.0}, "32": {"waist_min": 34.0, "waist_max": 34.0, "hip_min": 38.0, "hip_max": 39.0}, "34": {"waist_min": 36.0, "waist_max": 36.0, "hip_min": 40.0, "hip_max": 41.0}, "36": {"waist_min": 38.0, "waist_max": 38.0, "hip_min": 42.0, "hip_max": 43.0}, "38": {"waist_min": 40.0, "waist_max": 40.0, "hip_min": 44.0, "hip_max": 45.0}, "40": {"waist_min": 42.0, "waist_max": 42.0, "hip_min": 46.0, "hip_max": 47.0}, "42": {"waist_min": 44.0, "waist_max": 44.0, "hip_min": 48.0, "hip_max": 49.0}, "44": {"waist_min": 46.0, "waist_max": 46.0, "hip_min": 50.0, "hip_max": 51.0}}}, "GOREWEAR": {"sizes": {"XS": {"waist_min": 27.5, "waist_max": 29.5, "hip_min": 33.0, "hip_max": 35.0}, "S": {"waist_min": 29.75, "waist_max": 32.0, "hip_min": 35.5, "hip_max": 37.5}, "M": {"waist_min": 32.25, "waist_max": 34.25, "hip_min": 37.75, "hip_max": 39.75}, "L": {"waist_min": 34.75, "waist_max": 37.0, "hip_min": 40.25, "hip_max": 42.0}, "XL": {"waist_min": 37.5, "waist_max": 40.25, "hip_min": 42.5, "hip_max": 45.0}, "XXL": {"waist_min": 40.5, "waist_max": 43.25, "hip_min": 45.25, "hip_max": 47.75}}}, "Outdoor Research": {"sizes": {"XS": {"waist_min": 26.5, "waist_max": 29.0, "hip_min": 32.5, "hip_max": 35.0}, "S": {"waist_min": 29.0, "waist_max": 31.5, "hip_min": 35.0, "hip_max": 37.5}, "M": {"waist_min": 31.5, "waist_max": 34.5, "hip_min": 37.5, "hip_max": 40.5}, "L": {"waist_min": 34.5, "waist_max": 37.5, "hip_min": 40.5, "hip_max": 43.5}, "XL": {"waist_min": 37.5, "waist_max": 41.5, "hip_min": 43.5, "hip_max": 46.0}, "XXL": {"waist_min": 41.5, "waist_max": 45.5, "hip_min": 46.0, "hip_max": 49.5}, "XXXL": {"waist_min": 45.5, "waist_max": 50.0, "hip_min": 49.5, "hip_max": 53.0}}}, "Pearl Izumi": {"sizes": {"XS": {"waist_min": 27.5, "waist_max": 29.5, "hip_min": 33.5, "hip_max": 35.5}, "S": {"waist_min": 29.5, "waist_max": 31.5, "hip_min": 34.5, "hip_max": 36.5}, "M": {"waist_min": 31.5, "waist_max": 34.5, "hip_min": 36.5, "hip_max": 39.5}, "L": {"waist_min": 34.5, "waist_max": 37.5, "hip_min": 39.5, "hip_max": 42.5}, "XL": {"waist_min": 37.5, "waist_max": 42.0, "hip_min": 42.5, "hip_max": 46.5}, "2XL": {"waist_min": 42.0, "waist_max": 47.0, "hip_min": 46.5, "hip_max": 50.5}, "3XL": {"waist_min": 47.0, "waist_max": 52.0, "hip_min": 50.5, "hip_max": 53.5}}}, "Rapha": {"sizes": {"XS": {"waist_min": 28.0, "waist_max": 28.0, "hip_min": 34.5, "hip_max": 34.5}, "S": {"waist_min": 30.5, "waist_max": 30.5, "hip_min": 37.0, "hip_max": 37.0}, "M": {"waist_min": 33.0, "waist_max": 33.0, "hip_min": 39.0, "hip_max": 39.0}, "L": {"waist_min": 35.5, "waist_max": 35.5, "hip_min": 41.5, "hip_max": 41.5}, "XL": {"waist_min": 38.0, "waist_max": 38.0, "hip_min": 44.0, "hip_max": 44.0}, "XXL": {"waist_min": 40.0, "waist_max": 40.0, "hip_min": 46.5, "hip_max": 46.5}}}, "Ripton": {"sizes": {"XS": {"waist_min": 27.0, "waist_max": 29.0, "hip_min": 31.0, "hip_max": 33.0}, "S": {"waist_min": 30.0, "waist_max": 32.0, "hip_min": 35.0, "hip_max": 37.0}, "M": {"waist_min": 33.0, "waist_max": 35.0, "hip_min": 39.0, "hip_max": 41.0}, "L": {"waist_min": 36.0, "waist_max": 38.0, "hip_min": 43.0, "hip_max": 47.0}, "X": {"waist_min": 39.0, "waist_max": 43.0, "hip_min": 49.0, "hip_max": 53.0}, "XXL": {"waist_min": 44.0, "waist_max": 48.0, "hip_min": 55.0, "hip_max": 59.0}}}}
        };

        let currentView = 'all';
        let selectedBrand = null;

        // Colors for each brand - using custom brand palette
        const brandColors = {
            '7mesh': '#393710',
            'Club Ride': '#B6AB40',
            'Fox Racing': '#375160',
            'GOREWEAR': '#9EB7C5',
            'Outdoor Research': '#252525',
            'Pearl Izumi': '#523B20',
            'Rapha': '#978C6F',
            'Ripton': '#9EB7C5'
        };

        // Initialize brand tabs
        function initTabs() {
            const tabsContainer = document.getElementById('brandTabs');
            Object.keys(data.brands).forEach(brand => {
                const btn = document.createElement('button');
                btn.className = 'brand-tab';
                btn.textContent = brand;
                btn.onclick = () => selectBrand(brand);
                tabsContainer.appendChild(btn);
            });
        }

        function selectBrand(brand) {
            selectedBrand = brand;
            currentView = 'single';
            updateTabs();
            draw();
        }

        function showAllBrands() {
            currentView = 'all';
            selectedBrand = null;
            updateTabs();
            draw();
        }

        function updateTabs() {
            document.querySelectorAll('.brand-tab').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === selectedBrand) {
                    btn.classList.add('active');
                }
            });

            document.querySelector('.all-brands-btn').classList.toggle('active', currentView === 'all');
        }

        function getAxisScale() {
            const waistValues = data.anthropometric_data.map(d => d[0]);
            const hipValues = data.anthropometric_data.map(d => d[1]);

            return {
                waistMin: Math.floor(Math.min(...waistValues) - 2),
                waistMax: Math.ceil(Math.max(...waistValues) + 2),
                hipMin: Math.floor(Math.min(...hipValues) - 2),
                hipMax: Math.ceil(Math.max(...hipValues) + 2)
            };
        }

        function draw() {
            const svg = document.getElementById('chart');
            const width = Math.min(1000, svg.parentElement.offsetWidth - 40);
            const height = 600;
            const margin = { top: 20, right: 30, bottom: 50, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const scale = getAxisScale();

            // Scale functions
            const scaleX = (d) => margin.left + ((d - scale.waistMin) / (scale.waistMax - scale.waistMin)) * plotWidth;
            const scaleY = (d) => margin.top + plotHeight - ((d - scale.hipMin) / (scale.hipMax - scale.hipMin)) * plotHeight;

            // Clear SVG
            svg.innerHTML = '';
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            // Background
            const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            bg.setAttribute('width', width);
            bg.setAttribute('height', height);
            bg.setAttribute('fill', '#ffffff');
            svg.appendChild(bg);

            // Grid
            for (let i = scale.waistMin; i <= scale.waistMax; i += 5) {
                const x = scaleX(i);
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x);
                line.setAttribute('y1', margin.top);
                line.setAttribute('x2', x);
                line.setAttribute('y2', height - margin.bottom);
                line.setAttribute('stroke', '#e0e0e0');
                line.setAttribute('stroke-width', '1');
                svg.appendChild(line);
            }

            for (let i = scale.hipMin; i <= scale.hipMax; i += 5) {
                const y = scaleY(i);
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', margin.left);
                line.setAttribute('y1', y);
                line.setAttribute('x2', width - margin.right);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#e0e0e0');
                line.setAttribute('stroke-width', '1');
                svg.appendChild(line);
            }

            // Axes
            const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            xAxis.setAttribute('x1', margin.left);
            xAxis.setAttribute('y1', height - margin.bottom);
            xAxis.setAttribute('x2', width - margin.right);
            xAxis.setAttribute('y2', height - margin.bottom);
            xAxis.setAttribute('stroke', '#333');
            xAxis.setAttribute('stroke-width', '2');
            svg.appendChild(xAxis);

            const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            yAxis.setAttribute('x1', margin.left);
            yAxis.setAttribute('y1', margin.top);
            yAxis.setAttribute('x2', margin.left);
            yAxis.setAttribute('y2', height - margin.bottom);
            yAxis.setAttribute('stroke', '#333');
            yAxis.setAttribute('stroke-width', '2');
            svg.appendChild(yAxis);

            // Axis labels
            const xLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            xLabel.setAttribute('x', width / 2);
            xLabel.setAttribute('y', height - 10);
            xLabel.setAttribute('text-anchor', 'middle');
            xLabel.setAttribute('font-size', '14');
            xLabel.setAttribute('fill', '#333');
            xLabel.textContent = 'Waist (inches)';
            svg.appendChild(xLabel);

            const yLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            yLabel.setAttribute('x', -height / 2);
            yLabel.setAttribute('y', 15);
            yLabel.setAttribute('text-anchor', 'middle');
            yLabel.setAttribute('font-size', '14');
            yLabel.setAttribute('fill', '#333');
            yLabel.setAttribute('transform', 'rotate(-90)');
            yLabel.textContent = 'Hip (inches)';
            svg.appendChild(yLabel);

            // Tick marks and labels
            for (let i = scale.waistMin; i <= scale.waistMax; i += 5) {
                const x = scaleX(i);
                const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                tick.setAttribute('x1', x);
                tick.setAttribute('y1', height - margin.bottom);
                tick.setAttribute('x2', x);
                tick.setAttribute('y2', height - margin.bottom + 5);
                tick.setAttribute('stroke', '#333');
                svg.appendChild(tick);

                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x);
                label.setAttribute('y', height - margin.bottom + 20);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('font-size', '12');
                label.setAttribute('fill', '#666');
                label.textContent = i;
                svg.appendChild(label);
            }

            for (let i = scale.hipMin; i <= scale.hipMax; i += 5) {
                const y = scaleY(i);
                const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                tick.setAttribute('x1', margin.left - 5);
                tick.setAttribute('y1', y);
                tick.setAttribute('x2', margin.left);
                tick.setAttribute('y2', y);
                tick.setAttribute('stroke', '#333');
                svg.appendChild(tick);

                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', margin.left - 15);
                label.setAttribute('y', y + 4);
                label.setAttribute('text-anchor', 'end');
                label.setAttribute('font-size', '12');
                label.setAttribute('fill', '#666');
                label.textContent = i;
                svg.appendChild(label);
            }

            // Plot anthropometric data (background) - all 500 data points
            data.anthropometric_data.forEach(point => {
                const x = scaleX(point[0]);
                const y = scaleY(point[1]);
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', 2.5);
                circle.setAttribute('fill', '#aaa');
                circle.setAttribute('opacity', 0.4);
                svg.appendChild(circle);
            });

            // Plot brand boxes
            if (currentView === 'all') {
                Object.entries(data.brands).forEach(([brand, brandData]) => {
                    Object.entries(brandData.sizes).forEach(([size, box]) => {
                        const x1 = scaleX(box.waist_min);
                        const x2 = scaleX(box.waist_max);
                        const y1 = scaleY(box.hip_max);
                        const y2 = scaleY(box.hip_min);

                        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                        rect.setAttribute('x', x1);
                        rect.setAttribute('y', y1);
                        rect.setAttribute('width', x2 - x1);
                        rect.setAttribute('height', y2 - y1);
                        rect.setAttribute('fill', brandColors[brand]);
                        rect.setAttribute('opacity', 0.30);
                        rect.setAttribute('stroke', brandColors[brand]);
                        rect.setAttribute('stroke-width', 2.5);
                        svg.appendChild(rect);
                    });
                });

                updateLegend('all');
            } else if (selectedBrand) {
                const brandData = data.brands[selectedBrand];
                Object.entries(brandData.sizes).forEach(([size, box]) => {
                    const x1 = scaleX(box.waist_min);
                    const x2 = scaleX(box.waist_max);
                    const y1 = scaleY(box.hip_max);
                    const y2 = scaleY(box.hip_min);

                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttribute('x', x1);
                    rect.setAttribute('y', y1);
                    rect.setAttribute('width', x2 - x1);
                    rect.setAttribute('height', y2 - y1);
                    rect.setAttribute('fill', brandColors[selectedBrand]);
                    rect.setAttribute('opacity', 0.38);
                    rect.setAttribute('stroke', brandColors[selectedBrand]);
                    rect.setAttribute('stroke-width', 3);
                    svg.appendChild(rect);

                    // Add size label
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('x', (x1 + x2) / 2);
                    label.setAttribute('y', (y1 + y2) / 2);
                    label.setAttribute('text-anchor', 'middle');
                    label.setAttribute('dominant-baseline', 'middle');
                    label.setAttribute('font-size', '11');
                    label.setAttribute('font-weight', 'bold');
                    label.setAttribute('fill', brandColors[selectedBrand]);
                    label.textContent = size;
                    svg.appendChild(label);
                });

                updateLegend('single', selectedBrand);
            }
        }

        function updateLegend(view, brand) {
            const legend = document.getElementById('legend');
            legend.innerHTML = '';

            if (view === 'all') {
                const title = document.createElement('div');
                title.style.marginBottom = '8px';
                title.style.fontWeight = '600';
                title.style.fontSize = '13px';
                title.textContent = 'Brand Colors:';
                legend.appendChild(title);

                Object.keys(data.brands).forEach(brandName => {
                    const item = document.createElement('span');
                    item.className = 'legend-item';
                    item.innerHTML = `<span class="legend-color" style="background-color: ${brandColors[brandName]}"></span> ${brandName}`;
                    legend.appendChild(item);
                });
            } else if (brand) {
                const sizeList = Object.keys(data.brands[brand].sizes).join(', ');
                const item = document.createElement('span');
                item.className = 'legend-item';
                item.innerHTML = `<span class="legend-color" style="background-color: ${brandColors[brand]}"></span> ${brand} Available Sizes: ${sizeList}`;
                legend.appendChild(item);
            }
        }

        function updateStats() {
            const statsDiv = document.getElementById('stats');
            statsDiv.innerHTML = '';

            if (selectedBrand && currentView === 'single') {
                const sizes = Object.keys(data.brands[selectedBrand].sizes).length;
                statsDiv.innerHTML = `
                    <div class="stat-box">
                        <h3>Brand</h3>
                        <p>${selectedBrand}</p>
                    </div>
                    <div class="stat-box">
                        <h3>Available Sizes</h3>
                        <p>${sizes}</p>
                    </div>
                    <div class="stat-box">
                        <h3>Total Data Points</h3>
                        <p>${data.anthropometric_data.length}</p>
                    </div>
                `;
            } else {
                statsDiv.innerHTML = `
                    <div class="stat-box">
                        <h3>Total Brands</h3>
                        <p>${Object.keys(data.brands).length}</p>
                    </div>
                    <div class="stat-box">
                        <h3>Anthropometric Data Points</h3>
                        <p>${data.anthropometric_data.length}</p>
                    </div>
                    <div class="stat-box">
                        <h3>View Mode</h3>
                        <p>All Brands Overlay</p>
                    </div>
                `;
            }
        }

        // Initialize
        initTabs();
        updateTabs();
        draw();
        updateStats();

        // Redraw on window resize
        window.addEventListener('resize', draw);
    </script>
</body>
</html>
